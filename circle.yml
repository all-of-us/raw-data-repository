dependencies:
  override:
    # chmod to address a Circle "bug", since gcloud lives at /opt
    # and wants to make a .staging directory (as a sibling!)
    # when upgrading or installing new components.
    - sudo chmod o+w /opt
    - pip install --upgrade httplib2
    - pip install --upgrade oauth2client

test:
  override:
    - ./ci/test.sh

deployment:
  # Deploy master to the pmi-drc-api-test project whenever the tests pass
  test:
    branch: master
    commands:
      - ./ci/deploy_to_test.sh pmi-drc-api-test
  # To deploy to staging, cut a GitHub release on a green build, with tag of the form v0.1.1-rc0
  staging:
    tag: /v[0-9]+(\.[0-9]+)*-rc[0-9]+/
    commands:
      - ./ci/deploy_to_test.sh all-of-us-rdr-staging
    
