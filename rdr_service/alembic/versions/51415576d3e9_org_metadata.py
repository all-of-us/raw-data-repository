"""Org metadata

Revision ID: 51415576d3e9
Revises: b315fec9aa4e
Create Date: 2017-11-30 09:35:32.331486

"""
import model.utils
import sqlalchemy as sa
from alembic import op
from sqlalchemy.dialects import mysql

from rdr_service.model.site_enums import SiteStatus

# revision identifiers, used by Alembic.
revision = "51415576d3e9"
down_revision = "b315fec9aa4e"
branch_labels = None
depends_on = None


def upgrade(engine_name):
    globals()[f"upgrade_{engine_name}"]()


def downgrade(engine_name):
    globals()[f"downgrade_{engine_name}"]()


def upgrade_metrics():
    # ### commands auto generated by Alembic - please adjust! ###
    pass
    # ### end Alembic commands ###


def downgrade_metrics():
    # ### commands auto generated by Alembic - please adjust! ###
    pass
    # ### end Alembic commands ###


def upgrade_rdr():
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table(
        "organization",
        sa.Column("organization_id", sa.Integer(), nullable=False),
        sa.Column("external_id", sa.String(length=80), nullable=False),
        sa.Column("display_name", sa.String(length=255), nullable=False),
        sa.Column("hpo_id", sa.Integer(), nullable=False),
        sa.ForeignKeyConstraint(["hpo_id"], ["hpo.hpo_id"]),
        sa.PrimaryKeyConstraint("organization_id"),
    )
    op.add_column("site", sa.Column("address_1", sa.String(length=1024), nullable=True))
    op.add_column("site", sa.Column("address_2", sa.String(length=1024), nullable=True))
    op.add_column("site", sa.Column("admin_emails", sa.String(length=4096), nullable=True))
    op.add_column("site", sa.Column("city", sa.String(length=255), nullable=True))
    op.add_column("site", sa.Column("directions", sa.String(length=1024), nullable=True))
    op.add_column("site", sa.Column("latitude", sa.Float(), nullable=True))
    op.add_column("site", sa.Column("launch_date", sa.Date(), nullable=True))
    op.add_column("site", sa.Column("link", sa.String(length=255), nullable=True))
    op.add_column("site", sa.Column("longitude", sa.Float(), nullable=True))
    op.add_column("site", sa.Column("notes", sa.String(length=1024), nullable=True))
    op.add_column("site", sa.Column("organization_id", sa.Integer(), nullable=True))
    op.add_column("site", sa.Column("phone_number", sa.String(length=80), nullable=True))
    op.add_column("site", sa.Column("physical_location_name", sa.String(length=1024), nullable=True))
    op.add_column("site", sa.Column("site_status", model.utils.Enum(SiteStatus), nullable=True))
    op.add_column("site", sa.Column("state", sa.String(length=2), nullable=True))
    op.add_column("site", sa.Column("zip_code", sa.String(length=10), nullable=True))
    op.alter_column("site", "hpo_id", existing_type=mysql.INTEGER(display_width=11), nullable=True)
    op.create_foreign_key(None, "site", "organization", ["organization_id"], ["organization_id"])
    op.drop_column("site", "consortium_name")
    # ### end Alembic commands ###


def downgrade_rdr():
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column("site", sa.Column("consortium_name", mysql.VARCHAR(length=255), nullable=False))
    op.drop_constraint(None, "site", type_="foreignkey")
    op.alter_column("site", "hpo_id", existing_type=mysql.INTEGER(display_width=11), nullable=False)
    op.drop_column("site", "zip_code")
    op.drop_column("site", "state")
    op.drop_column("site", "site_status")
    op.drop_column("site", "physical_location_name")
    op.drop_column("site", "phone_number")
    op.drop_column("site", "organization_id")
    op.drop_column("site", "notes")
    op.drop_column("site", "longitude")
    op.drop_column("site", "link")
    op.drop_column("site", "launch_date")
    op.drop_column("site", "latitude")
    op.drop_column("site", "directions")
    op.drop_column("site", "city")
    op.drop_column("site", "admin_emails")
    op.drop_column("site", "address_2")
    op.drop_column("site", "address_1")
    op.drop_table("organization")
    # ### end Alembic commands ###
